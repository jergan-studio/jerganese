<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jerganese</title>

<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="/icon.ico?v=1">
<link rel="shortcut icon" href="/icon.ico?v=1">

<!-- Apple/iOS home screen icon -->
<link rel="apple-touch-icon" sizes="180x180" href="/icon.ico?v=1">

<style>
html, body { margin:0; padding:0; overflow:hidden; }
#game { display:block; }

#namePrompt {
  position:absolute;
  top:0; left:0;
  width:100%; height:100%;
  background:#2ecc40;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:10;
  flex-direction:column;
}

#chatInput {
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  width:300px; padding:5px;
  z-index:5;
}

#messages {
  position:fixed;
  top:10px;
  left:10px;
  max-height:300px;
  overflow:auto;
  background:rgba(255,255,255,0.7);
  padding:5px;
  z-index:5;
  font-family:sans-serif;
  font-size:14px;
}

#playerCount {
  position:fixed;
  top:10px;
  right:10px;
  background:rgba(255,255,255,0.7);
  padding:5px;
  font-family:sans-serif;
  font-size:14px;
  z-index:5;
}

#weatherHUD {
  position:fixed;
  top:50px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(255,255,255,0.7);
  padding:5px 10px;
  font-family:sans-serif;
  font-size:18px;
  z-index:5;
}

/* Video overlay */
#videoOverlay {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.8);
  justify-content:center;
  align-items:center;
  z-index:20;
}
#videoOverlay div { position:relative; }
#videoOverlay iframe { width:640px; height:360px; }
#closeVideo {
  position:absolute;
  top:-20px; right:-20px;
  font-size:22px;
  background:white;
  border-radius:50%;
  padding:4px 8px;
  cursor:pointer;
}
</style>
</head>
<body>

<!-- Name prompt -->
<div id="namePrompt">
  <input type="text" id="nameInput" placeholder="Enter your name">
  <button onclick="joinGame()">Join</button>
</div>

<!-- Game Canvas -->
<canvas id="game"></canvas>

<!-- Chat UI -->
<input type="text" id="chatInput" placeholder="Type a message...">
<div id="messages"></div>

<!-- HUDs -->
<div id="playerCount">Players Online: 0</div>
<div id="weatherHUD">Weather: ☀️ Clear</div>

<!-- Video Overlay for Boomboxes -->
<div id="videoOverlay">
  <div>
    <iframe id="boomboxVideo" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    <button id="closeVideo">✖</button>
  </div>
</div>

<!-- Background Music -->
<audio id="bgMusic" src="/background.mp3" loop></audio>

<!-- Socket.io + Game Script -->
<script src="/socket.io/socket.io.js"></script>
<script src="/game.js"></script>

<script>
const music = document.getElementById("bgMusic");
// Play background music after first interaction
document.body.addEventListener("click", () => music.play().catch(()=>{}), { once:true });

// Close video overlay
document.getElementById("closeVideo").addEventListener("click", () => {
  document.getElementById("videoOverlay").style.display = "none";
  document.getElementById("boomboxVideo").src = "";
});

// Join game
function joinGame(){
  const name = document.getElementById("nameInput").value.trim();
  if(name.length<2) return alert("Name too short");
  socket.emit("setName", name);
  document.getElementById("namePrompt").style.display = "none";
  joined = true;
  socket.emit("requestBoomboxes"); // sync existing boomboxes
}
</script>

</body>
</html>
